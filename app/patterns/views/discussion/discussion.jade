section.summary
  h1 #{discussion.title}
  if discussion.description
    p !{discussion.description}
  dl.content-stats
    dt Topics
    dd #{discussion.topicsFormatted}
  include ../partials/pagination
  nav.actions
    ul
      li.new-topic
        a(href="topic/action/start/id/#{discussion.id}") Start a new topic
      if session.moderateDiscussions
        li.new-announcement
          a(href="topic/action/startAnnouncement/id/#{discussion.id}") Make an announcement

if announcements
  section.announcements
    h2 Announcements
    if session.moderateDiscussions
      nav.actions
        ul
          li.new-announcement
            a(href="topic/action/startAnnouncement/id/#{discussion.id}") Make an announcement
    each topic in announcements
      article(class="topic announcement #{ topic.unread ? 'unread' : '' } #{ topic.lockedByID ? 'locked' : '' }" data-topic-id="#{topic.id}")
        h3
          a(href="announcement/#{topic.url}/id/#{topic.id}") !{topic.titleHtml}

section.topics
  h2 Topics
  if discussion.id !== 1
    nav.actions
      ul
        li.new-topic
          a(href="topic/action/start/id/#{discussion.id}") Start a new topic
        if !announcements && session.moderateDiscussions
          li.new-announcement
            a(href="topic/action/startAnnouncement/id/#{discussion.id}") Make an announcement
        //- li.subscribe
        //-   a(href="#{route.pathname}/action/subscribe" title="Receive an e-mail notification when new topics are added to this discussion.") Subscribe

  if topics
    each topic in topics
      article(class="topic #{ topic.replies ? 'has-replies' : '' } #{ topic.unread ? 'unread' : '' } #{ topic.lockedByID ? 'locked' : '' }" data-topic-id="#{topic.id}")
        h3
          a(href="topic/#{topic.url}/id/#{topic.id}") !{topic.titleHtml}
        a.avatar(href="user/#{topic.topicStarterUrl}/id/#{topic.topicStarterID}" rel="author" title="View #{topic.topicStarter}'s profile.")
          img(src="avatars/#{topic.topicStarterID}.jpg")
        dl.byline
          dt.author Author
          dd.author
            a(href="user/#{topic.topicStarterUrl}/id/#{topic.topicStarterID}" rel="author" title="View #{topic.topicStarter}'s profile.") #{topic.topicStarter}
          dt.date Date
          dd.date
            = topic.postDateFormatted
        if topic.replies
          a.content-stats(href="topic/#{topic.url}/id/#{topic.id}")
            dl.content-stats
              dt.replies Replies
              dd.replies
                = topic.repliesFormatted
          p.last-post
            a.avatar(href="user/#{topic.lastPostAuthorUrl}/id/#{topic.lastPostAuthorID}" rel="author" title="View #{topic.lastPostAuthor}'s profile.")
              img(src="avatars/#{topic.lastPostAuthorID}.jpg")
            a(href="user/#{topic.lastPostAuthorUrl}/id/#{topic.lastPostAuthorID}" rel="author" title="View #{topic.lastPostAuthor}'s profile.")
              = topic.lastPostAuthor
            |  replied
            time #{topic.lastPostCreatedFormatted}
  else
    p This discussion has no topics. <a href="topic/action/start/id/#{discussion.id}">Why not start one?</a>

include ../partials/pagination
